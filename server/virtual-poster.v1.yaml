openapi: 3.0.0
info:
  title: virtual-poster
  version: "1.0"
  contact:
    name: Hiroyuki Kai
    email: fullerenec84@gmail.com
  description: Virtual poster API
  license:
    name: GPL or virtual-poster license
servers:
  - url: "http://localhost:3000/api"
paths:
  "/maps/{roomId}/people":
    parameters:
      - $ref: "#/components/parameters/debug_token"
      - $ref: "#/components/parameters/debug_as"
      - schema:
          type: string
        name: roomId
        in: path
        required: true
        description: Room ID
    get:
      summary: Get a list of people
      tags:
        - people
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/PersonInMap"
      operationId: get-maps-roomId-people
      parameters: []
      description: Get all people in the room
  "/people/{userId}":
    parameters:
      - $ref: "#/components/parameters/debug_token"
      - $ref: "#/components/parameters/debug_as"
      - schema:
          type: string
        name: userId
        in: path
        required: true
        description: ""
    get:
      summary: Get information on a user
      tags:
        - people
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PersonWithEmail"
            application/xml:
              schema:
                type: object
                properties: {}
      operationId: get-people-userId
      description: Get a person
      parameters:
        - schema:
            type: boolean
          in: query
          name: email
    patch:
      summary: Information on a user
      operationId: put-people-userId
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  error:
                    type: string
                  modified:
                    type: object
                    properties:
                      keys:
                        type: array
                        items:
                          type: string
                      update:
                        type: object
                        required:
                          - id
                          - last_updated
                        properties:
                          id:
                            type: string
                          last_updated:
                            type: number
                          name:
                            type: string
                          email:
                            type: string
                    required:
                      - keys
                      - update
                required:
                  - ok
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                name:
                  type: string
                  minLength: 1
                  maxLength: 8
                x:
                  type: integer
                  minimum: 0
                "y":
                  type: integer
                  minimum: 0
                avatar:
                  type: string
                "":
                  type: string
      tags:
        - people
      description: "Update person info  "
  /people:
    get:
      summary: List all users
      tags:
        - people
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/PersonWithEmail"
      operationId: get-people
      parameters:
        - schema:
            type: boolean
          in: query
          name: email
          description: Include email
          allowEmptyValue: true
        - $ref: "#/components/parameters/debug_token"
        - $ref: "#/components/parameters/debug_as"
      description: List all users who are visible to the user
    post:
      summary: Create a new user
      operationId: post-people
      responses:
        "200":
          description: OK
      parameters:
        - $ref: "#/components/parameters/debug_token"
        - $ref: "#/components/parameters/debug_as"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                name:
                  type: string
                  minLength: 1
                avatar:
                  type: string
                rooms:
                  type: array
                  items:
                    $ref: "#/components/schemas/RoomId"
                on_conflict:
                  type: string
                  enum:
                    - append
                    - reject
                    - replace
              required:
                - email
                - name
        description: ""
      description: Add new person
      tags:
        - people
  "/people_multi/{userIds}":
    get:
      summary: Get information on users
      tags:
        - people
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/PersonWithEmail"
      operationId: "get-people_multi-:userIds"
      description: "Get information on multiple users at one time  "
      parameters:
        - schema:
            type: boolean
          in: query
          name: email
          description: Return email address
    parameters:
      - $ref: "#/components/parameters/debug_token"
      - $ref: "#/components/parameters/debug_as"
      - schema:
          type: string
        name: userIds
        in: path
        required: true
        description: |
          User IDs, concatenated with "::::"
  /maps:
    parameters:
      - $ref: "#/components/parameters/debug_token"
      - $ref: "#/components/parameters/debug_as"
    get:
      summary: Get a list of rooms
      tags:
        - map
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    numCols:
                      type: integer
                      minimum: 0
                    numRows:
                      type: integer
                      minimum: 0
                    id:
                      type: string
                      minLength: 1
                    name:
                      type: string
                      minLength: 1
                    poster_location_count:
                      type: integer
                      minimum: 0
                    poster_count:
                      type: integer
                      minimum: 0
                  required:
                    - numCols
                    - numRows
                    - id
                    - name
                    - poster_location_count
                    - poster_count
      operationId: get-maps
      description: Get a list of rooms
  "/maps/{roomId}":
    parameters:
      - $ref: "#/components/parameters/debug_token"
      - $ref: "#/components/parameters/debug_as"
      - schema:
          type: string
        name: roomId
        in: path
        required: true
    get:
      summary: Get a map
      tags:
        - map
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  numCols:
                    type: integer
                  numRows:
                    type: integer
                  cells:
                    type: array
                    items:
                      type: array
                      items:
                        $ref: "#/components/schemas/Cell"
                required:
                  - numCols
                  - numRows
                  - cells
      operationId: get-maps-roomId
      description: Get room information
  "/maps/{roomId}/enter":
    parameters:
      - $ref: "#/components/parameters/debug_token"
      - $ref: "#/components/parameters/debug_as"
      - schema:
          type: string
        name: roomId
        in: path
        required: true
    post:
      summary: Enter a room
      operationId: post-maps-roomId-enter
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  status:
                    type: string
                  public_key:
                    type: string
                  socket_url:
                    type: string
                  socket_protocol:
                    type: string
                    enum:
                      - Socket.IO
                      - WebSocket
                required:
                  - ok
      tags:
        - map
      description: Enter a room
  "/maps/{roomId}/groups/{groupId}/join":
    post:
      summary: Join a chat
      operationId: "post-maps-:room_id-groups-:group_id-join"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  error:
                    type: string
                  joinedGroup:
                    $ref: "#/components/schemas/ChatGroup"
                required:
                  - ok
      description: "Join a chat group. You can only join one chat group at maximum.  "
      tags:
        - chat
    parameters:
      - $ref: "#/components/parameters/debug_token"
      - $ref: "#/components/parameters/debug_as"
      - schema:
          type: string
          minLength: 1
        name: roomId
        in: path
        required: true
      - schema:
          type: string
        name: groupId
        in: path
        required: true
  "/maps/{roomId}/groups/{groupId}/leave":
    parameters:
      - $ref: "#/components/parameters/debug_token"
      - $ref: "#/components/parameters/debug_as"
      - schema:
          type: string
        name: roomId
        in: path
        required: true
      - schema:
          type: string
        name: groupId
        in: path
        required: true
    post:
      summary: Leave a chat group
      operationId: post-maps-roomId-groups-groupId-leave
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  error:
                    type: string
                  leftGroup:
                    $ref: "#/components/schemas/ChatGroup"
                required:
                  - ok
      description: Leave a chat group.
      tags:
        - chat
  "/maps/{roomId}/groups/{groupId}/people":
    parameters:
      - $ref: "#/components/parameters/debug_token"
      - $ref: "#/components/parameters/debug_as"
      - schema:
          type: string
        name: roomId
        in: path
        required: true
      - schema:
          type: string
        name: groupId
        in: path
        required: true
    post:
      summary: Add a new person to a chat
      tags:
        - chat
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  error:
                    type: string
                  joinedGroup:
                    $ref: "#/components/schemas/ChatGroup"
                required:
                  - ok
      operationId: get-maps-roomId-groups-groupId-people
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                userId:
                  type: string
              required:
                - userId
      description: Get people of a group in a room
  "/maps/{roomId}/groups":
    parameters:
      - $ref: "#/components/parameters/debug_token"
      - $ref: "#/components/parameters/debug_as"
      - schema:
          type: string
        name: roomId
        in: path
        required: true
    post:
      summary: Make a new chat group
      tags:
        - chat
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  error:
                    type: string
                  group:
                    $ref: "#/components/schemas/ChatGroup"
                required:
                  - ok
      operationId: post-maps-roomId-groups
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                fromUser:
                  $ref: "#/components/schemas/UserId"
                toUsers:
                  type: array
                  items:
                    $ref: "#/components/schemas/UserId"
              required:
                - fromUser
                - toUsers
      description: Create a new chat group
    get:
      summary: List members of a chat group
      operationId: get-maps-roomId-groups
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ChatGroup"
      description: List members of a chat group
      tags:
        - chat
  /groups:
    get:
      summary: Get chat groups
      tags:
        - chat
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ChatGroup"
      operationId: get-chat-groups
      description: Get chat groups (Return type stub)
    parameters:
      - $ref: "#/components/parameters/debug_token"
      - $ref: "#/components/parameters/debug_as"
  "/maps/{roomId}/people/{userId}/groups":
    parameters:
      - $ref: "#/components/parameters/debug_token"
      - $ref: "#/components/parameters/debug_as"
      - schema:
          type: string
        name: roomId
        in: path
        required: true
      - schema:
          type: string
        name: userId
        in: path
        required: true
    get:
      summary: Get a group the user belongs to.
      tags:
        - chat
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatGroup"
      operationId: get-maps-roomId-people-userId-groups
      description: Get a chat group of the user in a room
  "/maps/{roomId}/comments":
    parameters:
      - $ref: "#/components/parameters/debug_token"
      - $ref: "#/components/parameters/debug_as"
      - schema:
          type: string
        name: roomId
        in: path
        required: true
    get:
      summary: Get all comments in the room
      tags:
        - chat
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ChatComment"
      operationId: get-maps-roomId-comments
      description: Get all comments (that are visible to a user) in the room.
  "/posters/{posterId}/comments/{commentId}":
    parameters:
      - $ref: "#/components/parameters/debug_token"
      - $ref: "#/components/parameters/debug_as"
      - schema:
          type: string
        name: posterId
        in: path
        required: true
      - schema:
          type: string
        name: commentId
        in: path
        required: true
    patch:
      summary: Poster comment
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  error:
                    type: string
                  comment:
                    $ref: "#/components/schemas/ChatComment"
                required:
                  - ok
      operationId: patch-posters-posterId-comments-commentId
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                comment:
                  type: string
      tags:
        - poster
      description: Update poster comment
      parameters: []
  "/comments/{commentId}":
    parameters:
      - $ref: "#/components/parameters/debug_token"
      - $ref: "#/components/parameters/debug_as"
      - schema:
          type: string
        name: commentId
        in: path
        required: true
    patch:
      summary: Edit a comment
      tags:
        - chat
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  comment:
                    $ref: "#/components/schemas/CommentEncrypted"
                  error:
                    type: string
                required:
                  - ok
      operationId: patch-comments-commentId
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                comments:
                  type: array
                  items:
                    $ref: "#/components/schemas/CommentEncrypted"
      description: Edit a comment
    delete:
      summary: Delete a comment
      operationId: delete-comments-commentId
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  error:
                    type: string
                required:
                  - ok
      description: Delete a comment
      tags:
        - chat
  "/maps/{roomId}/people/{userId}/poster":
    parameters:
      - $ref: "#/components/parameters/debug_token"
      - $ref: "#/components/parameters/debug_as"
      - schema:
          type: string
        name: roomId
        in: path
        required: true
      - schema:
          type: string
        name: userId
        in: path
        required: true
    get:
      summary: Get a poster of a user in a room
      tags:
        - poster
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: string
                  poster:
                    type: string
      operationId: get-maps-roomId-people-userId-poster
      description: "Get a poster of the user in the room  "
  "/people/{userId}/posters":
    parameters:
      - $ref: "#/components/parameters/debug_token"
      - $ref: "#/components/parameters/debug_as"
      - schema:
          type: string
        name: userId
        in: path
        required: true
    get:
      summary: Get all posters of the user
      tags:
        - poster
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  posters:
                    type: array
                    items:
                      $ref: "#/components/schemas/Poster"
      operationId: get-people-userId-posters
      description: Get all poster of the user
  "/maps/{roomId}/people/{userId}/poster/file":
    post:
      summary: Upload a poster file
      tags:
        - poster
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  error:
                    type: string
                required:
                  - ok
      operationId: "post-maps-:roomId-people-:userId-poster-file"
      description: Upload a poster file
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties: {}
        description: Image file (PNG or PDF).
    parameters:
      - $ref: "#/components/parameters/debug_token"
      - $ref: "#/components/parameters/debug_as"
      - schema:
          type: string
        name: roomId
        in: path
        required: true
      - schema:
          type: string
        name: userId
        in: path
        required: true
  "/posters/{posterId}/file":
    parameters:
      - $ref: "#/components/parameters/debug_token"
      - $ref: "#/components/parameters/debug_as"
      - schema:
          type: string
        name: posterId
        in: path
        required: true
    get:
      summary: Get a poster file
      tags:
        - poster
      responses:
        "200":
          description: OK
          content:
            application/octet-stream:
              schema:
                type: object
                properties: {}
      operationId: get-posters-posterId-file
      description: Get a poster file
    post:
      summary: Upload a poster file
      operationId: post-posters-posterId-file
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  error:
                    type: string
                  poster:
                    $ref: "#/components/schemas/Poster"
                required:
                  - ok
      description: Upload a poster file
      tags:
        - poster
    delete:
      summary: Delete a poster file
      operationId: delete-posters-posterId-file
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  poster:
                    $ref: "#/components/schemas/Poster"
                  error:
                    type: string
                required:
                  - ok
      tags:
        - poster
      description: Delete a poster file
  "/posters/{posterId}/comments":
    post:
      summary: Post a comment on a poster
      tags:
        - poster
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                required:
                  - ok
      operationId: "post-maps-:roomId-posters-:posterId-comments"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  $ref: "#/components/schemas/UserId"
                comment:
                  type: string
      description: Add a comment on a poster
    parameters:
      - $ref: "#/components/parameters/debug_token"
      - $ref: "#/components/parameters/debug_as"
      - schema:
          type: string
        name: posterId
        in: path
        required: true
    get:
      summary: Get comments on a poster
      operationId: get-posters-posterId-comments
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ChatCommentDecrypted"
      tags:
        - poster
      description: Get comments on a poster
  /posters:
    parameters:
      - $ref: "#/components/parameters/debug_token"
      - $ref: "#/components/parameters/debug_as"
    get:
      summary: Get all posters
      tags:
        - poster
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Poster"
      operationId: get-posters
      description: Only for admin
  "/maps/{roomId}/posters":
    parameters:
      - $ref: "#/components/parameters/debug_token"
      - $ref: "#/components/parameters/debug_as"
      - schema:
          type: string
        name: roomId
        in: path
        required: true
    get:
      summary: Get all posters in a room
      tags:
        - poster
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Poster"
      operationId: get-maps-roomId-posters
      description: Get all posters in a room
  /id_token:
    parameters:
      - $ref: "#/components/parameters/debug_token"
      - $ref: "#/components/parameters/debug_as"
    post:
      summary: Submit ID token
      tags:
        - auth
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  error:
                    type: string
                  user_id:
                    $ref: "#/components/schemas/UserId"
                  admin:
                    type: boolean
                  public_key:
                    type: string
                  debug_token:
                    type: string
                  registered:
                    type: string
                    enum:
                      - can_register
                      - registered
                  name:
                    type: string
                  updated:
                    type: boolean
                  token_actual:
                    type: string
                required:
                  - ok
                  - updated
      operationId: post-id_token
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
                debug_from:
                  type: string
                force:
                  type: boolean
      parameters:
        - schema:
            type: string
          in: query
          name: debug_as
        - schema:
            type: string
          in: query
          name: debug_token
      description: Register Firebase Auth ID token
  /ping:
    get:
      summary: Ping
      tags:
        - misc
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: string
                pattern: pong
                default: pong
      operationId: get-ping
      description: "Return pong. Used for health check, etc.  "
      security: []
  /socket_url:
    get:
      summary: Get socket URL
      tags: []
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  socket_url:
                    type: string
      operationId: get-socket_url
      description: "Get the URL of a socket server  "
  /public_key:
    get:
      summary: Get my public key
      tags:
        - misc
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  public_key:
                    type: string
                required:
                  - ok
      operationId: get-public_key
      description: Get my public key
    post:
      summary: Post my public key
      operationId: post-public_key
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                required:
                  - ok
      description: Post my public key
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                key:
                  type: string
                force:
                  type: boolean
              required:
                - key
      tags:
        - misc
  /logout:
    post:
      summary: Logout
      tags:
        - auth
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                required:
                  - ok
      operationId: post-logout
      description: Logout from the app and remove cookie
  "/maps/{roomId}/poster_slots/{posterNumber}":
    parameters:
      - schema:
          type: string
        name: roomId
        in: path
        required: true
      - schema:
          type: number
        name: posterNumber
        in: path
        required: true
    post:
      summary: Take a poster slot
      tags:
        - poster
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
      operationId: post-maps-roomId-take_slot-posterLocation
      description: Take a poster slot
    delete:
      summary: ""
      operationId: delete-maps-roomId-poster_slot-posterNumber
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
      description: "Release a poster slot the user reserved  "
      parameters: []
  /latency_report:
    post:
      summary: Submit a latency report
      tags:
        - misc
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                required:
                  - ok
      operationId: post-latency_report
      description: Submit a latency report. Used for performance metrics.
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                properties:
                  url:
                    type: string
                  method:
                    type: string
                    enum:
                      - GET
                      - POST
                      - PATCH
                      - PUT
                      - DELETE
                      - HEAD
                      - OPTIONS
                      - LINK
                      - UNLINK
                  latency:
                    type: number
                  timestamp:
                    type: integer
        description: ""
  /register:
    post:
      summary: Register a user
      tags:
        - people
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  user:
                    $ref: "#/components/schemas/PersonWithEmail"
                  error:
                    type: string
                required:
                  - ok
      operationId: post-register
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                name:
                  type: string
                access_code:
                  type: string
              required:
                - email
                - name
                - access_code
      description: "Register a new user from their web browser  "
  /blind_sign/key_pair:
    get:
      summary: Get a key pair for blind signature
      tags:
        - misc
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  "N":
                    type: string
                  E:
                    type: string
                required:
                  - "N"
                  - E
      operationId: get-blind_sign-key_pair
      description: Get a key pair for blind signature.
  /blind_sign/sign:
    post:
      summary: Sign a message with blind signature
      tags:
        - misc
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  signed:
                    type: string
                required:
                  - ok
      operationId: post-blind_sign-sign
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                blinded:
                  type: string
              required:
                - blinded
  /blind_sign/verify:
    get:
      summary: Verify blind signature
      tags:
        - misc
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                required:
                  - ok
      operationId: get-blind_sign-verify
      parameters:
        - schema:
            type: string
          in: query
          name: unblinded
        - schema:
            type: string
          in: query
          name: message
      description: "Verify blind signature  "
  "/maps/{roomId}/groups/{groupId}/comments":
    parameters:
      - schema:
          type: string
        name: roomId
        in: path
        required: true
      - schema:
          type: string
        name: groupId
        in: path
        required: true
    post:
      summary: Send a comment to a chat group
      operationId: post-maps-roomId-comments
      responses:
        "200":
          description: OK
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/CommentEncrypted"
        description: ""
      description: Post a comment in a room
      tags:
        - chat
  "/maps/{roomId}/posters/{posterId}/approach":
    parameters:
      - schema:
          type: string
        name: roomId
        in: path
        required: true
      - schema:
          type: string
        name: posterId
        in: path
        required: true
    post:
      summary: Approach the poster
      tags:
        - map
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
      operationId: post-maps-roomId-posters-posterId-approach
      description: Approach a poster by walking.
  "/people/{userId}/access_code":
    parameters:
      - schema:
          type: string
        name: userId
        in: path
        required: true
    post:
      summary: Post an access code
      tags: []
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  error:
                    type: string
                required:
                  - ok
      operationId: post-people-userId-access_code
      description: "Post an access code for rooms, etc."
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                access_code:
                  type: string
              required:
                - access_code
  "/posters/{posterId}":
    parameters:
      - schema:
          type: string
        name: posterId
        in: path
        required: true
    patch:
      summary: Update poster info
      tags:
        - poster
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
      operationId: patch-posters-posterId
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
              required:
                - title
      description: Update poster info.
components:
  parameters:
    debug_token:
      in: query
      name: debug_token
      required: false
      schema:
        type: string
      description: Debug token
    debug_as:
      in: query
      name: debug_as
      required: false
      schema:
        type: string
      description: Debug as a user
  schemas:
    Person:
      title: Person
      type: object
      description: Person
      x-examples: {}
      x-tags:
        - types
      properties:
        id:
          type: string
        name:
          type: string
        last_updated:
          type: integer
        public_key:
          type: string
      required:
        - id
        - name
        - last_updated
    PersonWithEmail:
      title: PersonWithEmail
      type: object
      description: Person with email
      x-examples:
        example-1: {}
      x-tags:
        - types
      properties:
        id:
          type: string
        name:
          type: string
        last_updated:
          type: integer
        email:
          type: string
          format: email
        public_key:
          type: string
        stats:
          $ref: "#/components/schemas/PersonStat"
      required:
        - id
        - name
        - last_updated
        - stats
    Cell:
      title: Cell
      type: object
      x-tags:
        - types
      description: Map cell
      properties:
        id:
          type: string
        x:
          type: integer
        "y":
          type: integer
        kind:
          type: string
          enum:
            - grass
            - wall
            - water
            - poster
            - poster_seat
            - mud
        open:
          type: boolean
      required:
        - id
        - x
        - "y"
        - kind
        - open
    ChatGroup:
      title: ChatGroup
      type: object
      description: Chat group
      x-tags:
        - types
      properties:
        id:
          $ref: "#/components/schemas/ChatGroupId"
        room:
          $ref: "#/components/schemas/RoomId"
        users:
          type: array
          items:
            $ref: "#/components/schemas/UserId"
        color:
          type: string
        kind:
          type: string
          enum:
            - poster
            - people
      required:
        - id
        - room
        - users
        - color
        - kind
    UserId:
      type: string
      title: UserId
      minLength: 1
      pattern: '[\w_-]+'
      maxLength: 15
      x-tags:
        - types
    PosterId:
      type: string
      title: PosterId
      minLength: 1
      pattern: '[\w_-]+'
      maxLength: 15
      x-tags:
        - types
    ChatGroupId:
      type: string
      title: ChatGroupID
      x-tags:
        - types
    RoomId:
      type: string
      title: RoomId
      minLength: 1
      x-tags:
        - types
    ChatCommentDecrypted:
      title: ChatComment
      type: object
      description: Chat comment object
      x-tags:
        - types
      properties:
        id:
          type: string
        timestamp:
          type: integer
        last_updated:
          type: integer
        room:
          $ref: "#/components/schemas/RoomId"
        x:
          type: integer
          minimum: 0
        "y":
          type: integer
          minimum: 0
        encrypted:
          type: array
          items:
            type: boolean
        person:
          $ref: "#/components/schemas/UserId"
        text_decrypted:
          type: string
        texts:
          type: array
          items:
            type: object
            properties:
              encrypted:
                type: boolean
              to:
                oneOf:
                  - $ref: "#/components/schemas/UserId"
                  - $ref: "#/components/schemas/PosterId"
            required:
              - encrypted
              - to
        kind:
          type: string
          enum:
            - poster
            - person
      required:
        - id
        - timestamp
        - last_updated
        - room
        - x
        - "y"
        - encrypted
        - person
        - text_decrypted
        - texts
        - kind
    CommentEncrypted:
      title: CommentEncrypted
      type: object
      description: Encrypted comment object
      x-tags:
        - types
      properties:
        to:
          type: string
        text:
          type: string
        encrypted:
          type: boolean
      required:
        - to
        - text
        - encrypted
    ChatComment:
      title: ChatCommentEncrypted
      type: object
      x-tags:
        - types
      properties:
        id:
          type: string
        timestamp:
          type: integer
        last_updated:
          type: integer
        room:
          $ref: "#/components/schemas/RoomId"
        x:
          type: integer
        "y":
          type: integer
        person:
          $ref: "#/components/schemas/UserId"
        kind:
          type: string
          enum:
            - poster
            - person
        texts:
          type: array
          items:
            $ref: "#/components/schemas/CommentEncrypted"
      required:
        - id
        - timestamp
        - last_updated
        - room
        - x
        - "y"
        - person
        - kind
        - texts
    Poster:
      title: Poster
      type: object
      properties:
        id:
          $ref: "#/components/schemas/PosterId"
        last_updated:
          type: integer
        title:
          type: string
        author:
          $ref: "#/components/schemas/UserId"
        room:
          $ref: "#/components/schemas/RoomId"
        location:
          type: string
        poster_number:
          type: integer
        x:
          type: number
        "y":
          type: number
        file_url:
          type: string
      required:
        - id
        - last_updated
        - author
        - room
        - location
        - x
        - "y"
        - file_url
      x-tags:
        - types
    PersonInMap:
      title: PersonInMap
      type: object
      description: ""
      properties:
        id:
          type: string
        room:
          type: string
        x:
          type: number
        "y":
          type: number
        direction:
          type: string
          enum:
            - up
            - down
            - left
            - right
            - none
        name:
          type: string
        last_updated:
          type: integer
        moving:
          type: boolean
        stats:
          $ref: "#/components/schemas/PersonStat"
      required:
        - id
        - room
        - x
        - "y"
        - direction
        - name
        - last_updated
        - moving
        - stats
    PersonStat:
      title: PersonStat
      type: object
      properties:
        walking_steps:
          type: integer
        people_encountered:
          type: array
          items:
            type: string
        chat_count:
          type: integer
        chat_char_count:
          type: integer
      required:
        - walking_steps
        - people_encountered
        - chat_count
        - chat_char_count
  securitySchemes:
    debugAs:
      type: apiKey
      in: query
      name: debug_as
    debugToken:
      type: apiKey
      in: query
      name: debug_token
tags:
  - name: chat
  - name: map
  - name: people
  - name: poster
  - name: auth
  - name: misc
security:
  - debugToken: []
